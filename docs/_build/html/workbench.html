<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LAF workbench &mdash; LAF-Fabric 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="LAF-Fabric 0.1 documentation" href="index.html" />
    <link rel="next" title="graf package" href="source/graf.html" />
    <link rel="prev" title="LAF/GrAF and data analysis" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="source/graf.html" title="graf package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="LAF/GrAF and data analysis"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">LAF-Fabric 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="laf-workbench">
<h1>LAF workbench<a class="headerlink" href="#laf-workbench" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-this-workbench">
<h2>What is this workbench?<a class="headerlink" href="#what-is-this-workbench" title="Permalink to this headline">¶</a></h2>
<p>This workbench is a pure Python tool for running Python scripts with access to the information in a LAF resource.
It has two major components:</p>
<ol class="arabic simple">
<li>a LAF compiler for transforming a LAF resource into binary data that loads very fast by Python</li>
<li>an execution environment that gives Python scripts access to LAF data and optimalization features</li>
</ol>
<p>The selling point of the workbench is performance, both in terms of speed and memory usage.
The second goal is to make it really easy for users to write analytic tasks straightforwardly in terms of LAF concepts
without bothering about performance.</p>
<p>The typical workflow is:</p>
<ol class="arabic simple">
<li>install a LAF resource somewhere on the filesystem. A LAF resource is a directory with a primary data file, annotation files and header files.</li>
<li>install the LAF workbench package somewhere on a computing system.</li>
<li>configure a calling script with the locations of the LAF directory and a work/results directory</li>
<li>write your own script, and put it where the workbench can see it</li>
<li>run the workbench by invoking the calling script</li>
</ol>
<p>The first time the workbench is used, the LAF resource will be compiled. This may take considerable time, say 10 minutes for a 2 GB resource on a Macbook Air (2012).
All subsequent times the compiled data will be loaded directly, which takes, in the same setting, 5 to 10 seconds.</p>
<p>After loading the data, the workbench invokes your script. If your script runs too slow, there are various options to make it run quicker. You can declare the LAF-features that you use in your script, and the workbench will construct indexes for them, if they do not already exist. Indexing costs 30 to 60 seconds (still in the same setting), and the performance gain is typically 20 to 60 fold. There are several <em>optimization flavours</em>, but the one that builds indexes is the only one that actually manages to increase the performance.</p>
</div>
<div class="section" id="how-to-use-the-workbench">
<h2>How to use the workbench?<a class="headerlink" href="#how-to-use-the-workbench" title="Permalink to this headline">¶</a></h2>
<p>Here are detailed instructions for installing, configuring and using the workbench.</p>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>This package is called <em>graf</em> and is a pure Python package. A recommended way of installing it is to download <em>graf-version.tar.gz</em> from the distribution directory on  <a class="reference external" href="https://github.com/dirkroorda/laf-fabric/tree/master/dist">Github</a> and unpack it in a directory of your choice. You get a directory with documentation, the package <em>graf</em>, a calling script <em>laf-fabric.py</em> and a directory <em>tasks</em> with example tasks. Either you run <em>setup.py</em> to install this package in your local Python tree, or you leave the package where you unpacked it. Here are the directions if you do the latter.</p>
</div>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The calling script is <em>laf-fabric.py</em>. In it is a configuration section between:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## CONFIG START</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">## CONFIG END.</span>
</pre></div>
</div>
<p>The things to change here are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">data_root</span></tt></dt>
<dd>Path to the directory containing the LAF resource.</dd>
<dt><tt class="docutils literal"><span class="pre">laf_source</span></tt></dt>
<dd>The directory name of the LAF resource.</dd>
<dt><tt class="docutils literal"><span class="pre">compiled</span> <span class="pre">source</span></tt></dt>
<dd>The directory name of the compiled resource. This directory will be created next to the <tt class="docutils literal"><span class="pre">laf_source</span></tt> directory.</dd>
<dt><tt class="docutils literal"><span class="pre">source_choices</span></tt></dt>
<dd>A dictionaries with abbreviations for the names of the header files within the LAF resource that the workbench can refer to.</dd>
</dl>
<p>Normally, a LAF resource has a <em>LAF-header file</em> and a <em>primary data header file</em>, aka. <em>the GrAF header file</em>. The workbench needs to look at a GrAF header file.
This header file has references to all files that make up the resource. You might want to restrict the workbench to only part of the annotation files in the resource, e.g. if there are big annotation files that do not contain features that are relevant for your analysis. In that case, you can copy the original GrAF header file, and leave out all references to files that you do not want to take into consideration. The <tt class="docutils literal"><span class="pre">source_choices</span></tt> dictionary must contain all GrAF header files that you want to choose from on the command line. There will be an option <tt class="docutils literal"><span class="pre">--source=key</span></tt> to select the header file that you want to point the workbench to.</p>
<p>Now you are set to run your tasks. You might want to run an example task from the examples in the <em>tasks</em> directory, but they might fail because they refer to features that might not occur in your resource. You can also write a task yourself and add it to the <em>tasks</em> directory.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>The workbench is a Python program that is invoked from the command line. It loads data, runs a task script, and then exits. Between invocations the workbench is not loaded in memory and does not eat CPU cycles.</p>
<p>For every single task execution you invoke the workbench by its calling script <em>laf-fabric.py</em>, supplying parameters for selecting the LAF source, the task and the optimization flavour. And there are miscellaneous options, of course.</p>
<p>Go to the directory where <em>laf-fabric.py</em> resides:</p>
<div class="highlight-python"><pre>cd «path_to_dir_of_laf-fabric.py»</pre>
</div>
<p>Then issue the following command, where <tt class="docutils literal"><span class="pre">«string»</span></tt> stands for variable text that you should provide, and material within <tt class="docutils literal"><span class="pre">[</span> <span class="pre">]</span></tt> is optional:</p>
<div class="highlight-python"><pre>python laf-fabric.py --source=«source» --optim=«flavour» --task=«task» [--force-compile] [--force-index]</pre>
</div>
<p>Explanation</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">«source»</span></tt></dt>
<dd>the key for the GrAF header file that you use to point to your LAF resource</dd>
<dt><tt class="docutils literal"><span class="pre">«task»</span></tt></dt>
<dd>the task that you want to execute. Must be a python script in the <em>tasks</em> directory</dd>
<dt><tt class="docutils literal"><span class="pre">«flavour»</span></tt></dt>
<dd><p class="first">the flavour of the optimization that you want to apply. Choices are:</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">plain</span></tt></dt>
<dd>no optimization at all. Due to the extreme packing of feature information in very simple, C-like datastructures, feature lookup is expensive. By not optimizing you pay for that.</dd>
<dt><tt class="docutils literal"><span class="pre">assemble</span></tt></dt>
<dd>read the feature declarations of the task at hand, and ensure that indexes exist for those features. Create and save them if they do not exist, load them when they do exist.</dd>
<dt><tt class="docutils literal"><span class="pre">assemble-all</span></tt></dt>
<dd>create all possible indexes. This takes a few minutes, but takes a fair amount of space, both on disk and in memory. At present there is no provision to save the index. It is recommended to use <tt class="docutils literal"><span class="pre">assemble-all</span></tt>. The index is shared between tasks on the same «source», so the indexes will be built gradually on demand and not exceed what is really needed. After a while there will be little need for new tasks to create new indexes.</dd>
<dt><tt class="docutils literal"><span class="pre">memo</span></tt></dt>
<dd>feature values will be cached. Before feature lookup a value will be retrieved from the cache if possible. Otherwise the feature value will be looked up and stored in the cache. It turns out not to be very efficient, because in many tasks feature values are only needed once. So there is overhead for caching and no gain. Moreover, they cache may easily take up an enormous amount of space.</dd>
</dl>
</dd>
<dt><tt class="docutils literal"><span class="pre">--force-compile</span></tt></dt>
<dd>If you have changed the LAF resource, the workbench will detect it and recompile it. The detection is based on the modified dates of the GrAF header file and the compiled files. In cases where the workbench did not detect a change, but you need to recompile, use this flag.</dd>
<dt><tt class="docutils literal"><span class="pre">--force-index</span></tt></dt>
<dd>Only relevant for the <tt class="docutils literal"><span class="pre">assemble</span></tt> flavour. If indexes are outdated without the system detecting it, you can force re-indexing by giving this flag.</dd>
</dl>
</div>
</div>
<div class="section" id="designed-for-performance">
<h2>Designed for Performance<a class="headerlink" href="#designed-for-performance" title="Permalink to this headline">¶</a></h2>
<p>Since there is a generic LAF tool for smaller resources, this tool has been designed with performance in mind.
In fact, performance has been the most important design criterion of all. In this section the decision and particulars are listed. There are also a few simplifications involved, see the section of <em>GrAF feature coverage</em> below.</p>
<p>There are several ideas involved in compiling a LAF resource into something that is compact, fast loadable, and amenable to efficient computing.</p>
<ol class="arabic simple">
<li>Replace everything by integers (nearly everything)</li>
<li>Store relationships between integers in <em>arrays</em>, that is, Python arrays</li>
<li>Store relationships between integers and sets of integers also in <em>arrays</em>.</li>
</ol>
<div class="section" id="explanation-of-these-ideas">
<h3>Explanation of these ideas<a class="headerlink" href="#explanation-of-these-ideas" title="Permalink to this headline">¶</a></h3>
<p><strong>Everything is integer</strong>
In LAF the pieces of data are heavily connected, and the expression of the connections are XML identifiers. Besides that, absolutely everything gets an identifier, whether or not those identifiers are targeted or not. In the compiled version we get rid of all identifiers. Everything: regions, nodes, edges, features, feature names, feature values, annotation labels will end up in an array, and hence can be identified by its numerical index in that array. For the only things that are essentially not integers (feature names, feature values, annotation labels) we will create mapping tables.</p>
<p><strong>Relationships between integers as Python arrays</strong>
In Python, an array is a C-like structure of memory slots of fixed size. You do not have arrays of arrays, nor arrays with mixed types. This makes array handling very efficient, especially loading data from disk and saving it to disk. Moreover, the amount of space in memory needed is like in C, without the overhead a scripting language usually adds to its data types.</p>
<p>There is an other advantage: a mapping normally consists of two columns of numbers, and numbers in the left column map to numbers in the right column. In the case of arrays of integers, we can leave out the left column: it is the array index, and does not have to be stored.</p>
<p><strong>Relationships between integers as Python arrays</strong>
If we want to map numbers to sets of numbers, we need to be more tricky, because we cannot store sets of numbers as integers. What we do instead is: we build two arrays, the first array points to data records in the second array. A data record in the second array consists of a number giving the length of the record, followed by that number of integers. The method <tt class="docutils literal"><span class="pre">arrayify</span></tt> (in <em>model.py</em>) takes a list of items and turns it in a double array.</p>
</div>
<div class="section" id="consequences">
<h3>Consequences<a class="headerlink" href="#consequences" title="Permalink to this headline">¶</a></h3>
<p>The concrete XML identifiers present in the LAF resource get lost. Whoever designs a LAF resource to be worked on by this workbench, should not rely on the values of the XML identifiers to derive implicit meanings from. I did that in initial stages, producing identifiers <tt class="docutils literal"><span class="pre">n_1,</span> <span class="pre">n_2,</span> <span class="pre">e_1,</span> <span class="pre">e_2</span></tt> etcetera for node 1, 2 and edge 1, 2. Don&#8217;t do that!</p>
</div>
</div>
<div class="section" id="graf-feature-coverage">
<h2>GrAF feature coverage<a class="headerlink" href="#graf-feature-coverage" title="Permalink to this headline">¶</a></h2>
<p>This tool cannot deal with LAF resources in their full generality.</p>
<p>In LAF, annotations have labels, and annotations are organized in annotation spaces. So an annotation space and a label uniquely define a kind of annotation. The content of an annotation can be a feature structure. A feature structure is a set of features and sub features, ordered again as a graph.
These are the main simplifications:</p>
<dl class="docutils">
<dt><em>annotation spaces</em></dt>
<dd>The workbench ignores annotation spaces altogether. So annotations are only grouped by annotation labels.</dd>
<dt><em>feature structures</em></dt>
<dd>This workbench can deal with feature structures that are merely sets of key-value pairs. The graph-like model of features and subfeatures is not supported.</dd>
<dt><em>annotations</em></dt>
<dd>Even annotations get lost. The workbench is primarily interested in features and values. It forgets the annotations in which they have been packaged except for:
* the annotation label,
* the target of the annotation (node or edge)
So in order to retrieve a feature value, one must specify an annotation label, a feature name, and a node or edge to which the annotation containing the feature had been attached.</dd>
<dt><em>dependencies</em></dt>
<dd>In LAF one can specify the dependencies of the files containing regions, nodes, edges and/or annotations. The workbench assumes that all dependent files are present in the resource. Hence the workbench reads all files mentioned in the GrAF header, in no particular order.</dd>
</dl>
</div>
<div class="section" id="development">
<h2>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h2>
<p>Many reasonable candidates for an API have not yet been implemented. Basically we have only:</p>
<dl class="docutils">
<dt><em>node iterator</em></dt>
<dd>iterator that produces nodes in the order by which they are anchored to the primary data (which are linearly ordered)</dd>
<dt><em>feature lookup</em></dt>
<dd>a function that gives the value of a feature attached by some annotation to some edge or node</dd>
</dl>
<p>Now Python does not have strict encapsulation of data structures, so by just inspecting the classes and objects you can reach out for all aspects of the LAF data that went into the compiled data. See the GrAF feature coverage for a specification of what data ends up in the compilation.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">LAF workbench</a><ul>
<li><a class="reference internal" href="#what-is-this-workbench">What is this workbench?</a></li>
<li><a class="reference internal" href="#how-to-use-the-workbench">How to use the workbench?</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#designed-for-performance">Designed for Performance</a><ul>
<li><a class="reference internal" href="#explanation-of-these-ideas">Explanation of these ideas</a></li>
<li><a class="reference internal" href="#consequences">Consequences</a></li>
</ul>
</li>
<li><a class="reference internal" href="#graf-feature-coverage">GrAF feature coverage</a></li>
<li><a class="reference internal" href="#development">Development</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">LAF/GrAF and data analysis</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="source/graf.html"
                        title="next chapter">graf package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/workbench.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="source/graf.html" title="graf package"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="LAF/GrAF and data analysis"
             >previous</a> |</li>
        <li><a href="index.html">LAF-Fabric 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Dirk Roorda.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>