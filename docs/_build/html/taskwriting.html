<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing Tasks &mdash; LAF-Fabric 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="LAF-Fabric 0.1 documentation" href="index.html" />
    <link rel="next" title="graf package" href="source/graf.html" />
    <link rel="prev" title="LAF workbench" href="workbench.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="source/graf.html" title="graf package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="workbench.html" title="LAF workbench"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">LAF-Fabric 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writing-tasks">
<h1>Writing Tasks<a class="headerlink" href="#writing-tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-task">
<h2>What is a task?<a class="headerlink" href="#what-is-a-task" title="Permalink to this headline">¶</a></h2>
<p>A task is an ordinary Python script with some magical capabilities for looking into a LAF resource (a <em>compiled</em> LAF resource to be precise).</p>
<p>A task gets those capabilities because it is called by the workbench. In order to be called by the workbench, you have to put into the <em>tasks</em> directory, next to the example tasks.</p>
<p>The workbench passes an object to your task, which contains the information needed to peek into the LAF resource. Conversely, in your task script you can pass some initialization information to the workbench, so that it can build or load the appropriate indexes.</p>
<p>Apart from these things, your script may contain arbitrary Python code, it may import arbitrary modules. The workbench is agnostic of your code.</p>
</div>
<div class="section" id="a-leading-example">
<h2>A leading example<a class="headerlink" href="#a-leading-example" title="Permalink to this headline">¶</a></h2>
<p>Our target LAF resource is the conversion of a text database with objects to nodes with annotations. Nodes correspond to objects. The types of objects translate to annotations with label <tt class="docutils literal"><span class="pre">db</span></tt> with the feature <tt class="docutils literal"><span class="pre">otype</span></tt>. Likewise for the id of objects and the anchoring of objects to primary data: the features <tt class="docutils literal"><span class="pre">minmonad</span></tt>, <tt class="docutils literal"><span class="pre">maxmonad</span></tt> and <tt class="docutils literal"><span class="pre">monads</span></tt> take care of that. In the original LAF it looks like this:</p>
<div class="highlight-python"><pre>&lt;node xml:id="n28737"&gt;&lt;link targets="w_1 w_2 w_3 w_4 w_5 w_6 w_7 w_8 w_9 w_10 w_11"/&gt;&lt;/node&gt;
&lt;a xml:id="al28737" label="db" ref="n28737"&gt;&lt;fs&gt;
    &lt;f name="otype" value="clause"/&gt;
    &lt;f name="oid" value="28737"/&gt;
    &lt;f name="monads" value="1-11"/&gt;
    &lt;f name="minmonad" value="1"/&gt;
    &lt;f name="maxmonad" value="11"/&gt;
&lt;/fs&gt;&lt;/a&gt;</pre>
</div>
<p>The example task <em>object.py</em> lists all objects in &#8220;resource order&#8221; with their original ids, object types etc and even their node number in the compiled resource.
Not very useful, but handy for debugging or linking new annotation files to the existing data. Here is a snippet of output:</p>
<div class="highlight-python"><pre> 426500   28737 clause               {1-11         }
 514887   34680 clause_atom          {1-11         }
1131695   84383 sentence             {1-11         }
1203049   88917 sentence_atom        {1-11         }
1385280   95056 half_verse           {1-4          }
 604948   59556 phrase               {1-2          }
 862057   40767 phrase_atom          {1-2          }
      1       2 word                 {1            }
      2       3 word                 {2            }
      3       4 word                 {3            }
 604949   59557 phrase               {3            }
 862058   40768 phrase_atom          {3            }
      4       5 word                 {4            }</pre>
</div>
<p>Note the same clause object <tt class="docutils literal"><span class="pre">28737</span></tt> as in the original LAF file.
Finally, here is the complete Python code of the task that produced this output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf8 -*-</span>

<span class="n">precompute</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;plain&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s">&quot;memo&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s">&quot;assemble&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;only_nodes&quot;</span><span class="p">:</span> <span class="s">&quot;db:oid,otype,monads&quot;</span><span class="p">,</span>
        <span class="s">&quot;only_edges&quot;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">&quot;assemble_all&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">graftask</span><span class="p">):</span>
    <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">Li</span><span class="p">,</span> <span class="n">Lr</span><span class="p">,</span> <span class="n">Ni</span><span class="p">,</span> <span class="n">Nr</span><span class="p">,</span> <span class="n">Vi</span><span class="p">,</span> <span class="n">Vr</span><span class="p">,</span> <span class="n">NN</span><span class="p">,</span> <span class="n">NNFV</span><span class="p">,</span> <span class="n">Fi</span><span class="p">,</span> <span class="n">Fr</span><span class="p">)</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">get_mappings</span><span class="p">()</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">add_result</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">NN</span><span class="p">():</span>
        <span class="n">oid</span> <span class="o">=</span> <span class="n">Fr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Li</span><span class="p">[</span><span class="s">&quot;db&quot;</span><span class="p">],</span> <span class="n">Ni</span><span class="p">[</span><span class="s">&quot;oid&quot;</span><span class="p">])</span>
        <span class="n">otype</span> <span class="o">=</span> <span class="n">Fr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Li</span><span class="p">[</span><span class="s">&quot;db&quot;</span><span class="p">],</span> <span class="n">Ni</span><span class="p">[</span><span class="s">&quot;otype&quot;</span><span class="p">])</span>
        <span class="n">monads</span> <span class="o">=</span> <span class="n">Fr</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Li</span><span class="p">[</span><span class="s">&quot;db&quot;</span><span class="p">],</span> <span class="n">Ni</span><span class="p">[</span><span class="s">&quot;monads&quot;</span><span class="p">])</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{:&gt;7} {:&gt;7} {:&lt;20} {{{:&lt;13}}}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">monads</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="information-flow-from-task-to-workbench">
<h2>Information flow from task to workbench<a class="headerlink" href="#information-flow-from-task-to-workbench" title="Permalink to this headline">¶</a></h2>
<p>The main thing the workbench needs to know about the task are directives for its processing. Remember that tasks can be run with different <em>flavours</em>.
A flavour is a way of optimizing tasks and it can be specified on the command line which flavour to use. A flavour may take some directives, such as
the indexes that have to be built, and the <tt class="docutils literal"><span class="pre">precompute</span></tt> dictionary is the place to specify the directives.
Currently, only the <tt class="docutils literal"><span class="pre">assemble</span></tt> flavour needs any directives. It needs to be told for which features indexes should be built. This must be specified separately for features that occur on nodes and that occur on edges.</p>
<p>The feature specification takes the form of a space separated string of items of the form:</p>
<div class="highlight-python"><pre>«annotation label»:«feature names»</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">«feature</span> <span class="pre">names»</span></tt> is a comma separated list of feature names. For all implied features <tt class="docutils literal"><span class="pre">«annotion</span> <span class="pre">label»:«feature</span> <span class="pre">name»</span></tt> an index will be created and saved if it does not already exist. If it exists already, it will be loaded.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Missing indexes.
If you use the <tt class="docutils literal"><span class="pre">assemble</span></tt> flavour you <strong>must</strong> instruct the workbench to make indexes for all features that you use in your task. The workbench will always use indexes when retrieving feature values. If you forget to mention a feature in the directives, the workbench will deliver the value <tt class="docutils literal"><span class="pre">None</span></tt>, even if the compiled LAF has a real value there. The reason for this behaviour is that it is to costly to let every feature lookup check whether the index exists.</p>
</div>
</div>
<div class="section" id="information-flow-from-workbench-to-task">
<h2>Information flow from workbench to task<a class="headerlink" href="#information-flow-from-workbench-to-task" title="Permalink to this headline">¶</a></h2>
<p>The workbench will call the function <tt class="docutils literal"><span class="pre">task(object)</span></tt> in your task script, and the thing that is passed to it as <tt class="docutils literal"><span class="pre">object</span></tt> is an object of class <tt class="docutils literal"><span class="pre">GrafTask</span></tt> (see <a class="reference internal" href="source/graf.html#module-graf.task" title="graf.task"><tt class="xref py py-class docutils literal"><span class="pre">graf.task</span></tt></a>). By using this object, you have to access all of its methods.</p>
<p>In order to write an efficient task, it is convenient to import the names of the most important methods as <em>local variables</em> of the <tt class="docutils literal"><span class="pre">task</span></tt> function. The lookup of names in Python is fastest for local names. And it makes the code much cleaner.</p>
<p>The method <tt class="docutils literal"><span class="pre">get_mappings</span></tt> delivers the methods, and it is up to you to give them names. It is recommended to stick to the names provided here in this example. Here is a short description of the corresponding methods.</p>
<p><tt class="docutils literal"><span class="pre">Fi</span></tt> and <tt class="docutils literal"><span class="pre">Fr</span></tt></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing Tasks</a><ul>
<li><a class="reference internal" href="#what-is-a-task">What is a task?</a></li>
<li><a class="reference internal" href="#a-leading-example">A leading example</a></li>
<li><a class="reference internal" href="#information-flow-from-task-to-workbench">Information flow from task to workbench</a></li>
<li><a class="reference internal" href="#information-flow-from-workbench-to-task">Information flow from workbench to task</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="workbench.html"
                        title="previous chapter">LAF workbench</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="source/graf.html"
                        title="next chapter">graf package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/taskwriting.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="source/graf.html" title="graf package"
             >next</a> |</li>
        <li class="right" >
          <a href="workbench.html" title="LAF workbench"
             >previous</a> |</li>
        <li><a href="index.html">LAF-Fabric 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Dirk Roorda.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>