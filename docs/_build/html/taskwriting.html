


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing Tasks &mdash; LAF Fabric 3.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'',
        VERSION:'3.0.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="LAF Fabric 3.0.0 documentation" href="index.html"/>
        <link rel="next" title="Background" href="background.html"/>
        <link rel="prev" title="Getting Started" href="getting-started.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="icon icon-home"> LAF Fabric</a>
        <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="welcome.html">Welcome</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-laf-fabric.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#workflow">Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#designed-for-performance">Designed for Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#graf-feature-coverage">GrAF feature coverage</a></li>
<li class="toctree-l2"><a class="reference internal" href="about-laf-fabric.html#future-directions">Future directions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#about">About</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#platforms">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#your-python-setup">Your python setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#get-laf-fabric">Get LAF-Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#install-laf-fabric">Install LAF-Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#configure-laf-fabric">Configure LAF-Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#get-the-data">Get the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-started.html#run-laf-fabric">Run LAF-Fabric</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Writing Tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-task">What is a task?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-leading-example">A leading example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-on-features">More on features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interactive-execution">Interactive execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#information-flow-from-task-to-laf-fabric">Information flow from task to LAF-Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="#information-flow-from-laf-fabric-to-task">Information flow from LAF-Fabric to task</a></li>
<li class="toctree-l2"><a class="reference internal" href="#input-and-output">Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#node-order">Node order</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linking-to-the-laf-resource">Linking to the LAF resource</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a><ul>
<li class="toctree-l2"><a class="reference internal" href="background.html#what-is-laf-graf">What is LAF/GrAF</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#data">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#existing-tools-for-laf-graf-resources">Existing tools for LAF/GrAF resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#laf-fabric">LAF-Fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#interactive-notebooks">Interactive notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#rationale">Rationale</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#implementation-highlights">Implementation highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#author">Author</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html#history">History</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tasks/modules.html">tasks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tasks/annox_create.html">annox_create module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/annox_use.html">annox_use module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/esther.html">esther module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/gender.html">gender module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/involved.html">involved module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/isaiah.html">isaiah module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/lingo.html">lingo module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/objects.html">objects module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/plain.html">plain module</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks/proper.html">proper module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="graf/modules.html">graf 3.0.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.graf">graf.graf module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.model">graf.model module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.notebook">graf.notebook module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.parse">graf.parse module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.shell">graf.shell module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.task">graf.task module</a></li>
<li class="toctree-l2"><a class="reference internal" href="graf/modules.html#module-graf.timestamp">graf.timestamp module</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">LAF Fabric</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="index.html">Docs</a> &raquo;</li>
  <li><a href="">Writing Tasks</a></li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="_sources/taskwriting.txt" rel="nofollow"> View page source</a>
      
    </li>
</ul>
<hr/>

          
  <div class="section" id="writing-tasks">
<h1>Writing Tasks<a class="headerlink" href="#writing-tasks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="what-is-a-task">
<h2>What is a task?<a class="headerlink" href="#what-is-a-task" title="Permalink to this headline">¶</a></h2>
<p>A task is an ordinary Python script with some magical capabilities
for looking into a LAF resource (a <em>compiled</em> LAF resource to be precise).</p>
<p>There are two scenarios for executing tasks:</p>
<div class="section" id="notebook-mode">
<h3>Notebook mode<a class="headerlink" href="#notebook-mode" title="Permalink to this headline">¶</a></h3>
<p>In notebook mode you write your tasks in code cells in iPython notebooks.
There you have to import LAF-Fabric, or rather the <em>graf</em> module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">graf</span>
<span class="kn">from</span> <span class="nn">graf.notebook</span> <span class="kn">import</span> <span class="n">Notebook</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is a list of current notebooks for LAF-fabric.</p>
<ul class="simple">
<li><a class="reference external" href="http://nbviewer.ipython.org/github/dirkroorda/laf-fabric/blob/master/notebooks/gender.ipynb">gender</a></li>
<li><a class="reference external" href="http://nbviewer.ipython.org/github/dirkroorda/laf-fabric/blob/master/notebooks/cooccurrences.ipynb">cooccurrences</a></li>
</ul>
<p>If you click on the link, you are taken to the public <a class="reference external" href="http://nbviewer.ipython.org">notebook viewer website</a>,
which shows static versions of notebooks without storing them.
In order to run them, you need to download them to your computer.</p>
</div>
<div class="section" id="workbench-mode">
<h3>Workbench mode<a class="headerlink" href="#workbench-mode" title="Permalink to this headline">¶</a></h3>
<p>In workbench mode you place your tasks into the <em>tasks</em> directory.
In your script you have to define a function <tt class="docutils literal"><span class="pre">task(graftask)</span></tt> that takes as its sole argument
an object that gives access to all the LAF data from your resource:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">graftask</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;this function executes your task&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>This scenario is handy if you have a bunch of tasks that you want to run in quick succession.</p>
</div>
</div>
<div class="section" id="a-leading-example">
<h2>A leading example<a class="headerlink" href="#a-leading-example" title="Permalink to this headline">¶</a></h2>
<p>Our target LAF resource is the Hebrew text data base (see <a class="reference internal" href="background.html#data"><em>Data</em></a>).
Some nodes are annotated as words, and some nodes as chapters.
Words in Hebrew are either masculine, or feminine, or unknown.
We want to plot the percentage of masculine and feminine words per chapter.
The names of chapters and the genders of words are coded as features inside annotations to the
nodes that represent words and chapters.</p>
</div>
<div class="section" id="more-on-features">
<h2>More on features<a class="headerlink" href="#more-on-features" title="Permalink to this headline">¶</a></h2>
<p>The features we need are present in an annotation space named <tt class="docutils literal"><span class="pre">shebanq</span></tt> (after the project
that produced this LAF resource).
The chapter features are labeled with <tt class="docutils literal"><span class="pre">sft</span></tt> and the other features with <tt class="docutils literal"><span class="pre">ft</span></tt>.</p>
<p>When LAF-Fabric compiles features into binary data, it forgets the annotations in which the features come,
but the annotation <em>space</em> and <em>label</em> are retained in a double prefix to the feature name.</p>
<p>LAF-Fabric remembers those features by their <em>fully qualified</em> names: <tt class="docutils literal"><span class="pre">shebanq:ft.gender</span></tt>, <tt class="docutils literal"><span class="pre">shebanq:sft.chapter</span></tt> etc.
There may also be annotations without feature contents. Such annotations will be stored as features with as name the
annotation label only, without the dot: <tt class="docutils literal"><span class="pre">shebanq:db</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Annotations may reference nodes or edges.
It is possible that nodes and edges have features with the same name.
However, LAF-Fabric maintains a strict distinction between features
of nodes and features of edges. They have separate name spaces, implicitly.
Features names that are used for nodes and edges may coexist, but their
data are in separate tables.</p>
</div>
<p>The example task <a class="reference internal" href="tasks/gender.html#module-gender" title="gender"><tt class="xref py py-mod docutils literal"><span class="pre">gender</span></tt></a> counts all words in the Hebrew bible and produces
a table, where each row consists of the bible book plus chapter, followed
by the percentage masculine words, followed by the percentage of feminine words in that chapter:</p>
<div class="highlight-python"><pre>Genesis 1   22.9    5.2
Genesis 2   19.2    6.48
Genesis 3   20.6    9.02
Genesis 4   32      11
Genesis 5   36.6    17.9
Genesis 6   22.7    8.7
Genesis 7   18.8    10.7
Genesis 8   16.7    8.94
Genesis 9   19.9    6.76
Genesis 10  22      4.45</pre>
</div>
<p>Finally, here is the complete Python code of the task that produced this output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>

<span class="n">load</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&quot;xmlids&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;shebanq&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&quot;node&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s">&quot;db.otype&quot;</span><span class="p">,</span>
                <span class="s">&quot;ft.gender&quot;</span><span class="p">,</span>
                <span class="s">&quot;sft.chapter,book&quot;</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="s">&quot;edge&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">task</span><span class="p">(</span><span class="n">graftask</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Counts the frequencies of words with male and female gender features.</span>
<span class="sd">    Outputs the frequencies in a tab-delimited file, with frequency values for</span>
<span class="sd">    each chapter in the whole Hebrew Bible.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">NN</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">API</span><span class="p">()</span>
    <span class="n">stats_file</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s">&quot;stats.txt&quot;</span><span class="p">)</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">cur_chapter</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">ch</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">NN</span><span class="p">():</span>
        <span class="n">otype</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">shebanq_db_otype</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&quot;word&quot;</span><span class="p">:</span>
            <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">F</span><span class="o">.</span><span class="n">shebanq_ft_gender</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;masculine&quot;</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">F</span><span class="o">.</span><span class="n">shebanq_ft_gender</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;feminine&quot;</span><span class="p">:</span>
                <span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&quot;chapter&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cur_chapter</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">masc</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fem</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_chapter</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">masc</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fem</span><span class="p">)</span>
                <span class="n">stats_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}</span><span class="se">\t</span><span class="s">{:.3g}</span><span class="se">\t</span><span class="s">{:.3g}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cur_chapter</span><span class="p">,</span> <span class="n">masc</span><span class="p">,</span> <span class="n">fem</span><span class="p">))</span>
            <span class="n">this_chapter</span> <span class="o">=</span> <span class="s">&quot;{} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">shebanq_sft_book</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="n">F</span><span class="o">.</span><span class="n">shebanq_sft_chapter</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">{:&lt;15}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">this_chapter</span><span class="p">))</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">cur_chapter</span> <span class="o">=</span> <span class="n">this_chapter</span>
</pre></div>
</div>
</div>
<div class="section" id="interactive-execution">
<h2>Interactive execution<a class="headerlink" href="#interactive-execution" title="Permalink to this headline">¶</a></h2>
<p>It is more fun to work with tasks interactively.
See <a class="reference internal" href="getting-started.html"><em>Getting Started</em></a> how to set it up.</p>
<p>In interactive mode, the data remains in memory after the task has completed.
You can then load additional packages and add pieces of python code
to do fancy things with your data, such as plotting graphs.</p>
<p>When your task has finished, put this into a cell:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">processor</span><span class="o">.</span><span class="n">final</span><span class="p">()</span>
</pre></div>
</div>
<p>This will close all output and input files, and show you
the location of those files plus a listing of them, complete
with sizes and modification times.</p>
<p>If you want to work with those files in following code cells,
you can get their location into a python variable, say <em>table_file</em>, as follows:</p>
<div class="highlight-python"><pre>table_file = processor.my_files(«filename»)</pre>
</div>
<p>LAF-Fabric does not check whether <tt class="docutils literal"><span class="pre">«filename»</span></tt> exists, it just
prepends the directory name to <tt class="docutils literal"><span class="pre">/«filename»</span></tt>.</p>
</div>
<div class="section" id="information-flow-from-task-to-laf-fabric">
<h2>Information flow from task to LAF-Fabric<a class="headerlink" href="#information-flow-from-task-to-laf-fabric" title="Permalink to this headline">¶</a></h2>
<p>The main thing LAF-Fabric needs to know about your task is a declaration of
what data the task will use.
The task needs to tell whether to load the primary data (with the region information),
which feature data should be loaded and whether XML identifier tables
should be loaded.
Some of these must be specified separately for nodes and edges.</p>
<p>The feature specification takes the form a dictionary, keyed by annotation spaces first
and then by kind (node or edge). Under those keys the declaration proceeds
with a list of lines specifying bunches of features as follows:</p>
<div class="highlight-python"><pre>«annotation label».«feature names»</pre>
</div>
<p>where <tt class="docutils literal"><span class="pre">«feature</span> <span class="pre">names»</span></tt> is a comma separated list of feature names without annotation labels.
For all implied features <tt class="docutils literal"><span class="pre">«annotation</span> <span class="pre">space»:«annotion</span> <span class="pre">label».«feature</span> <span class="pre">name»</span></tt> of the chosen kind (node or edge),
data will be loaded.
For all other features data will be unloaded, if still loaded.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>Missing feature data.</p>
<p class="last">If you forget to mention a feature in the load declaration and you
do use it in your task,
LAF-Fabric will stop your task and shout error messages at you.
If you declare features that do not exist in the LAF data, you just get
a warning. But if you try to use such features, you get also a loud error.</p>
</div>
</div>
<div class="section" id="information-flow-from-laf-fabric-to-task">
<h2>Information flow from LAF-Fabric to task<a class="headerlink" href="#information-flow-from-laf-fabric-to-task" title="Permalink to this headline">¶</a></h2>
<p>LAF-Fabric will call the function <em>task(object)</em> in your task script (assuming you follow workbench mode),
and the thing it hands over to it as <em>object</em> is an object of
class <a class="reference internal" href="graf/modules.html#graf.task.GrafTask" title="graf.task.GrafTask"><tt class="xref py py-class docutils literal"><span class="pre">GrafTask</span></tt></a>.
By using this object, you have to access all of its methods.</p>
<p>In notebook this handing over occurs when you say:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">processor</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to write an efficient task,
it is convenient to import the names of the API methods as <em>local variables</em> of the <em>task</em> function.
The lookup of names in Python is fastest for local names.
And it makes the code much cleaner.</p>
<p>The method <a class="reference internal" href="graf/modules.html#graf.task.GrafTask.API" title="graf.task.GrafTask.API"><tt class="xref py py-meth docutils literal"><span class="pre">API()</span></tt></a> delivers the methods,
and it is up to you to give them names.
It is recommended to stick to the names provided here in this example.
Here is a short description of the corresponding methods.</p>
<dl class="docutils">
<dt><em>F</em></dt>
<dd>All that you want to know about features and are not afraid to ask.
It is an object, and for each feature that you have declared, it has a member
with a handy name. For example, <tt class="docutils literal"><span class="pre">F.shebanq_db_otype</span></tt> is a feature object
that corresponds with the LAF feature given in an annotation in the annotation space <tt class="docutils literal"><span class="pre">shebanq</span></tt>,
with label <tt class="docutils literal"><span class="pre">db</span></tt> and name <tt class="docutils literal"><span class="pre">otype</span></tt>.
It is a node feature, because otherwise the name had a
<tt class="docutils literal"><span class="pre">_e</span></tt> appended to it.
You can look up a feature value of this feature, say for node <tt class="docutils literal"><span class="pre">n</span></tt>,by saying:
<tt class="docutils literal"><span class="pre">F.shebanq_db_otype.v(n)</span></tt>.</dd>
<dt><em>P(node)</em></dt>
<dd>Your gateway to the primary data. For nodes <em>n</em> that are linked to the primary data by one or more regions,
P(<em>n</em>) yields a set of chunks of primary data, corresponding with those regions.
The chunks are maximal, non-overlapping, ordered according to the primary data.
Every chunk is given as a tuple (<em>pos</em>, <em>text</em>), where <em>pos</em> is the position in the primary data where
the start of <em>text</em> can be found, and <em>text</em> is the chunk of actual text that is specified by the region.
The primary data is only available if you have specified in the <em>load</em> directives:
<tt class="docutils literal"><span class="pre">primary:</span> <span class="pre">True</span></tt></dd>
</dl>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Note that <em>text</em> may be empty.
This happens in cases where the region is not a true interval but merely
a point between two characters.</p>
</div>
<dl class="docutils">
<dt><em>NN(test=function value=something)</em></dt>
<dd>If you want to walk through all the nodes, possibly skipping some, then this is your method.
It is an <em>iterator</em> that yields a new node everytime it is called.
The order is so-called <em>primary data order</em>, which will be explained below.
The <tt class="docutils literal"><span class="pre">test</span></tt> and <tt class="docutils literal"><span class="pre">value</span></tt> arguments are optional.
If given, <tt class="docutils literal"><span class="pre">test</span></tt> should be a <em>callable</em> with one argument, returning a string;
<tt class="docutils literal"><span class="pre">value</span></tt> should be a string.
<tt class="docutils literal"><span class="pre">test</span></tt> will be called for each passing node,
and if the value returned is not equal to the given <tt class="docutils literal"><span class="pre">value</span></tt>,
the node will be skipped.
See <a class="reference internal" href="graf/modules.html#graf.task.GrafTask.API" title="graf.task.GrafTask.API"><tt class="xref py py-meth docutils literal"><span class="pre">next_node()</span></tt></a>.</dd>
<dt><em>X</em></dt>
<dd>If you need to convert the integers that identify nodes and edges in the compiled data back to
their original XML identifiers, you can do that with the <em>X</em> object.
It has two members, <tt class="docutils literal"><span class="pre">X.node</span></tt> and <tt class="docutils literal"><span class="pre">X.edge</span></tt>, which contain the separate mapping tables for
nodes and edges. Both have two methods, corresponding to the direction of the translation:
with <tt class="docutils literal"><span class="pre">X.node.i(«xml</span> <span class="pre">id»)</span></tt> you get the corresponding number of a node, and with <tt class="docutils literal"><span class="pre">X.node.r(«number»)</span></tt>
you get the original XML id by which the node was identified in the LAF resource.</dd>
<dt>msg(text, newline=True, withtime=True)</dt>
<dd>Use this to write a message with time information to the terminal and log file.
Normally it appends a newline to the text, but you can suppress it.
You can also suppress the time indication before the text.</dd>
</dl>
</div>
<div class="section" id="input-and-output">
<h2>Input and Output<a class="headerlink" href="#input-and-output" title="Permalink to this headline">¶</a></h2>
<p>You can create an output filehandle, open for writing, by calling the
method <a class="reference internal" href="graf/modules.html#graf.task.GrafTask.add_output" title="graf.task.GrafTask.add_output"><tt class="xref py py-meth docutils literal"><span class="pre">add_output()</span></tt></a>
and assigning the result to a variable, say <em>out</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">out</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s">&quot;output.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>From then on you can write output simply by saying:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p>You can create as many output handles as you like in this way.
All these files and up in the task specific working directory.</p>
<p>Likewise, you can place additional input files in that directory,
and read them by saying:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">inp</span> <span class="o">=</span> <span class="n">graftask</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s">&quot;input.txt&quot;</span><span class="p">)</span>
<span class="n">inp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p>Once your task has finished, LAF-Fabric will close them all.</p>
</div>
<div class="section" id="node-order">
<span id="id1"></span><h2>Node order<a class="headerlink" href="#node-order" title="Permalink to this headline">¶</a></h2>
<p>There is an implicit partial order on nodes, derived from their attachment to <em>regions</em>
which are stretches of primary data, and the primary data is totally ordered.
The order we use in LAF-Fabric is defined as follows.</p>
<p>Suppose we compare node <em>A</em> and node <em>B</em>.
Look up all regions for <em>A</em> and for <em>B</em> and determine the first point of the first region
and the last point of the last region for <em>A</em> and <em>B</em>, and call those points <em>Amin, Amax</em>, <em>Bmin, Bmax</em> respectively.</p>
<p>Then region <em>A</em> comes before region <em>B</em> if and only if <em>Amin</em> &lt; <em>Bmin</em> or <em>Amin</em> = <em>Bmin</em> and <em>Amax</em> &gt; <em>Bmax</em>.</p>
<p>In other words: if <em>A</em> starts before <em>B</em>, then <em>A</em> becomes before <em>B</em>.
If <em>A</em> and <em>B</em> start at the same point, the one that ends last, counts as the earlier of the two.</p>
<p>If neither <em>A</em> &lt; <em>B</em> nor <em>B</em> &lt; <em>A</em> then the order is not specified.
LAF-Fabric will select an arbitrary but consistent order between thoses nodes.
The only way this can happen is when <em>A</em> and <em>B</em> start and end at the same point.
Between those points they might be very different.</p>
<p>The nice property of this ordering is that if a set of nodes consists of a proper hierarchy with respect to embedding,
the order specifies a walk through the nodes were enclosing nodes come first,
and embedded children come in the order dictated by the primary data.</p>
</div>
<div class="section" id="linking-to-the-laf-resource">
<h2>Linking to the LAF resource<a class="headerlink" href="#linking-to-the-laf-resource" title="Permalink to this headline">¶</a></h2>
<p>As a consequence of LAF-Fabric&#8217;s efficient implementation of the data in a LAF resource,
the concrete XML identifiers present in the LAF resource have been replaced by integers.
For normal operations this is noproblem whatsoever.</p>
<p>But when you want to add new annotations to your LAF resource, you eventually need the
original XML identifiers in order to specify the nodes or edges they point to.</p>
<p>In that case you can ask LAF-Fabric to load mappings
between the xml-identifiers and the internal integer codes for nodes and for edges.
This requires considerable overhead.</p>
<p>Whoever designs a LAF resource to be worked on by LAF-fabric,
should not rely on XML identifiers with an ad-hoc syntax with implicit meaning.
For example, if you use identifiers <tt class="docutils literal"><span class="pre">n_1,</span> <span class="pre">n_2,</span> <span class="pre">e_1,</span> <span class="pre">e_2</span></tt> for node 1, 2 and edge 1, 2,
there is nothing wrong with that.
But it is not recommended that in your tasks you split those identifiers up in order to
see whether it denotes a node or an edge.</p>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="background.html" class="btn btn-neutral float-right" title="Background"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="getting-started.html" class="btn btn-neutral" title="Getting Started"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, Dirk Roorda.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>